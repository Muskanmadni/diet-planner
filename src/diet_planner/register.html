<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NutriGuide - Register</title>

    <style>
        * {margin:0;padding:0;box-sizing:border-box;}
        body{
            font-family:Arial,sans-serif;
            background:linear-gradient(135deg,#4CAF50,#45a049);
            color:#333;line-height:1.6;
            min-height:100vh;
            display:flex;justify-content:center;align-items:center;
            padding:20px;
        }
        .container{
            max-width:500px;width:100%;background:#fff;border-radius:10px;
            box-shadow:0 10px 20px rgba(0,0,0,.2);overflow:hidden;
        }
        .header{
            background:#4CAF50;color:#fff;padding:25px;text-align:center;
        }
        .header h1{margin:0;font-size:1.8rem;}
        .form-container{padding:30px;}
        .form-group{margin-bottom:20px;}
        .form-group label{
            display:block;margin-bottom:8px;font-weight:bold;color:#555;
        }
        .form-group input,
        .form-group select{
            width:100%;padding:12px;border:1px solid #ddd;border-radius:5px;
            font-size:16px;transition:border-color .3s;
        }
        .form-group input:focus,
        .form-group select:focus{
            outline:none;border-color:#4CAF50;
            box-shadow:0 0 5px rgba(76,175,80,.3);
        }
        .btn{
            width:100%;padding:14px;background:#4CAF50;color:#fff;
            border:none;border-radius:5px;font-size:16px;cursor:pointer;
            transition:background .3s;
        }
        .btn:hover{background:#45a049;}
        .btn:active{transform:translateY(1px);}
        .login-link{
            text-align:center;margin-top:20px;
        }
        .login-link a{
            color:#4CAF50;text-decoration:none;font-weight:bold;
        }
        .login-link a:hover{text-decoration:underline;}
        .divider{
            text-align:center;margin:20px 0;position:relative;color:#888;
        }
        .divider::before{
            content:'';position:absolute;top:50%;left:0;right:0;height:1px;
            background:#ddd;
        }
        .divider span{background:#fff;padding:0 1rem;}
        .auth0-btn{
            display:block;width:100%;padding:12px;background:#eb4d4b;
            color:#fff;text-align:center;border-radius:5px;
            text-decoration:none;font-weight:600;transition:background .3s;
        }
        .auth0-btn:hover{background:#c44543;}
        @media(max-width:600px){
            .container{margin:10px;}
            .form-container{padding:20px;}
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="/static/images/logo.png" alt="NutriGuide Logo"
                 style="height:30px;margin:0 auto 10px;display:block;">
            <h1 style="margin:5px 0;">Create Account</h1>
            <p style="margin:5px 0 0 0;font-size:0.9rem;">Join Smart Diet Planner Today</p>
        </div>

        <div class="form-container">

            <!-- ==== STEP 1 – Email & Password ==== -->
            <div id="step1">
                <h2 style="text-align:center;margin-bottom:20px;">Create Account</h2>
                <p style="text-align:center;margin-bottom:25px;color:#666;">
                    Enter your account details to get started
                </p>

                <form id="step1Form">
                    <div class="form-group">
                        <label for="reg_email">Email Address</label>
                        <input type="email" id="reg_email" required>
                    </div>

                    <div class="form-group">
                        <label for="reg_password">Password</label>
                        <input type="password" id="reg_password" required>
                    </div>

                    <div class="form-group">
                        <label for="reg_confirm_password">Confirm Password</label>
                        <input type="password" id="reg_confirm_password" required>
                    </div>

                    <button type="submit" class="btn">Continue to Profile</button>
                </form>

                <!-- Divider + Auth0 button -->
                <div class="divider"><span>OR</span></div>
                <a href="/auth0/login" class="auth0-btn">
                    Continue with Google / Email
                </a>
            </div>

            <!-- ==== STEP 2 – Profile ==== -->
            <div id="step2" style="display:none;">
                <h2 style="text-align:center;margin-bottom:20px;">Complete Your Profile</h2>
                <p style="text-align:center;margin-bottom:25px;color:#666;">
                    Fill in your details to customize your experience
                </p>

                <form id="step2Form">
                    <div class="form-group">
                        <label for="current_weight">Current Weight (kg)</label>
                        <input type="number" id="current_weight" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label for="height">Height (cm)</label>
                        <input type="number" id="height" step="0.1" required>
                    </div>

                    <div class="form-group">
                        <label for="gender">Gender</label>
                        <select id="gender" required>
                            <option value="">Select Gender</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="goal_type">Goal</label>
                        <select id="goal_type" required>
                            <option value="">Select Goal</option>
                            <option value="lose">Lose Weight</option>
                            <option value="gain">Gain Weight</option>
                            <option value="maintain">Maintain Weight</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="weight_goal">Target Weight (kg)</label>
                        <input type="number" id="weight_goal" step="0.1" required>
                    </div>

                    <button type="submit" class="btn">Complete Registration</button>
                </form>
            </div>

        </div>

        <div class="login-link">
            <p>Already have an account? <a href="/login">Login here</a></p>
        </div>
    </div>

    <script>
        // ---- Step 1 → Step 2 (email/password) ----
        document.getElementById('step1Form').addEventListener('submit', e => {
            e.preventDefault();

            const email = document.getElementById('reg_email').value.trim();
            const pwd   = document.getElementById('reg_password').value;
            const cpwd  = document.getElementById('reg_confirm_password').value;

            if (pwd !== cpwd) {
                alert('Passwords do not match!');
                return;
            }

            // Store credentials for the final POST
            window.tempReg = { email, password: pwd };

            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
        });

        // ---- Final registration (profile + credentials) ----
        document.getElementById('step2Form').addEventListener('submit', async e => {
            e.preventDefault();

            const profile = {
                current_weight: parseFloat(document.getElementById('current_weight').value),
                height:         parseFloat(document.getElementById('height').value),
                gender:         document.getElementById('gender').value,
                goal_type:      document.getElementById('goal_type').value,
                weight_goal:    parseFloat(document.getElementById('weight_goal').value)
            };

            const payload = { ...window.tempReg, ...profile };

            try {
                const res = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const data = await res.json();

                if (res.ok) {
                    alert('Registration successful! Redirecting…');
                    window.location.href = '/dashboard';
                } else {
                    alert('Registration failed: ' + (data.error || 'Unknown error'));
                }
            } catch (err) {
                console.error(err);
                alert('Network error – please try again.');
            }
        });
    </script>
</body>
</html>